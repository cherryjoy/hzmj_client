TableTop = {}

function TableTop:Start( )
    self.IsInit = false
    self.PlayNum = 0
    self.LeftNum = 0
end

function TableTop:OnDestroy( )

end

function TableTop:CardInfoSync(handnum)
    for i = 1, handnum do
        LuaUIViewCtr.OpenUINotLoseNest("MJTable/TopCard",self.Grid:get_gameObject())
        --ref.Back:set_depth(i + 2)
    end

    self.Grid:Reposition()
end

function TableTop:LeftCardSync(owncards)
    if owncards.pengcard ~= nil then
        for i = 1, #(owncards.pengcard) do
            local card = owncards.pengcard[i]
            for num = 1, 3 do
                TableBottom.SetLeftCard(self, card)
            end
        end
    end

    --gangcardm gangcarda
    if owncards.gangcardm ~= nil then
        for i = 1, #(owncards.gangcardm) do
            local card = owncards.gangcardm[i]
            for num = 1, 4 do
                TableBottom.SetLeftCard(self, card)
            end
        end
    end

    if owncards.gangcarda ~= nil then
        for i = 1, #(owncards.gangcarda) do
            local card = owncards.gangcarda[i]
            for num = 1, 4 do
                TableBottom.SetLeftCard(self, card)
            end
        end
    end

    local pos = self.LeftCardGrid:get_transform():get_localPosition()
    local posY = pos:y() + self.LeftCardGrid:cellHeight()*self.LeftNum
    self.LeftCardGrid:get_transform():set_localPosition(LuaVector3.Create(pos:x(), posY, pos:z()))
    self.LeftCardGrid:Reposition()
end

function TableTop:SetLeftCard(card)
    LuaDebug.Log("left card, type: "..card.type_id..", id: "..card.code_id)
    local ref = LuaUIViewCtr.OpenUINotLoseNest("MJTable/TopPengCard",self.LeftCardGrid:get_gameObject())
    local spriteName = MJTableCtrl.GetLeftCardSprite(card)
    ref.Card:set_spriteName(spriteName)
    ref.Card:MakePixelPerfectWithSizeInAtlas()

    self.LeftNum = self.LeftNum + 1
end

function TableTop:PlayCard(i, card, toward)
    --LuaDebug.Log("play card, type: "..card.type_id..", id: "..card.code_id)
    local ref = LuaUIViewCtr.OpenUINotLoseNest("MJTable/TopPlayCard",self.PlayedCardsGrid:get_gameObject())
    local spriteName = MJTableCtrl.GetLeftCardSprite(card)
    ref.Card:set_spriteName(spriteName)
    ref.Card:MakePixelPerfectWithSizeInAtlas()
    if card.type_id == enumCARD_TYPE.CARD_WANG_TYPE or card.type_id == enumCARD_TYPE.CARD_HONG_TYPE then
        ref.Card:get_transform():set_localScale(LuaVector3.Create(-1, 1, 1))
    end

    local row = math.floor(self.PlayNum / 8)
    local colum = self.PlayNum % 8

    local pos = ref.TopPlayCard:get_transform():get_localPosition()
    ref.TopPlayCard:get_transform():set_localPosition(LuaVector3.Create(pos:x()-colum*36, pos:y()+row*43, pos:z()))

    ref.Card:set_depth(ref.Card:get_depth() - row*2)
    ref.Back:set_depth(ref.Back:get_depth() - row*2)

    toward:get_transform():SetParent(ref.TopPlayCard:get_transform())
    toward:get_transform():set_localPosition(LuaVector3.Create(0, 0, 0))

    self.PlayNum = self.PlayNum + 1
end

function TableTop:PlayCardEnd()

end

function TableTop:SetHeadInfo(info)
    self.roleId = info.roleid
    local ref = LuaUIViewCtr.OpenUINotLoseNest("MJTable/TableHead",self.HeadInfo)
    ref.gameObject:get_transform():set_localPosition(LuaVector3.Create(284, 0, 0))
    ref.Init(ref, info)
end
