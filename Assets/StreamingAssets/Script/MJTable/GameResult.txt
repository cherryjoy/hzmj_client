GameResult = {}

function GameResult:Start( )
    Client.TableClose = Client.TableClose + {self, GameResult.TableClose}
end

function GameResult:OnDestroy( )
    Client.TableClose = Client.TableClose - {self, GameResult.TableClose}
end

function GameResult:Init(data, roleList)
    for i = 1, #(data.role_cards) do
        if data.role_cards[i].roleid == Client.RoleInfo.RoleID then
            local ref = LuaUIViewCtr.OpenUINotLoseNest("MJTable/RoleResult",self.Center)
            ref.gameObject:get_transform():set_localPosition(LuaVector3.Create(-400, 250, 0))
            local info = MJTableCtrl.GetRoleInfo(data.role_cards[i].roleid, roleList)
            ref.Init(ref, data.role_cards[i], info)
            ref.Background:set_enabled(true)
            if data.role_list ~= nil and #(data.role_list) > 0 then
                for j = 1, #(data.role_list) do
                    if Client.RoleInfo.RoleID == data.role_list[j] then
                        ref.SetCodeCards(ref, data.code_cards)
                        break
                    end
                end
            else
                if Client.RoleInfo.RoleID == data.roleid then
                    ref.SetCodeCards(ref, data.code_cards)
                end
            end
            break
        end
    end

     local num = 0
     for i = 1, #(data.role_cards) do
         if data.role_cards[i].roleid ~= Client.RoleInfo.RoleID then
             num = num + 1

             local ref = LuaUIViewCtr.OpenUINotLoseNest("MJTable/RoleResult",self.Center)
             ref.gameObject:get_transform():set_localPosition(LuaVector3.Create(-400, 250 - num*90, 0))
             local info = MJTableCtrl.GetRoleInfo(data.role_cards[i].roleid, roleList)
             ref.Init(ref, data.role_cards[i], info)
             if data.role_list ~= nil and #(data.role_list) > 0 then
                 for j = 1, #(data.role_list) do
                     if data.role_cards[i].roleid == data.role_list[j] then
                         ref.SetCodeCards(ref, data.code_cards)
                         break
                     end
                 end
             else
                 if data.role_cards[i].roleid == data.roleid then
                     ref.SetCodeCards(ref, data.code_cards)
                 end
             end
         end
     end

     if data.rest_cards ~= nil then
         for i = 1, #(data.rest_cards) do
             local ref = LuaUIViewCtr.OpenUINotLoseNest("MJTable/MyCard", self.RestCardsGrid:get_gameObject())
             ref.gameObject:get_transform():set_localScale(LuaVector3.Create(0.6, 0.6, 1))
             ref.Init(ref, data.rest_cards[i], i)
         end

         self.RestCardsGrid:Reposition()
     end

     if Client.RoleInfo.Used + 1 == Client.RoleInfo.Amount then
         self.Ready:SetActive(false)
         self.Share:SetActive(false)
         Timer.NewEvent(self,40,40,GameResult.GetResult, false, nil)
     end
 end

function GameResult:GetResult()
    ClientSendMsg.SendGameBalance()

    self.gameObject:Destroy1()
end

function GameResult:Ready_OnClick()
    --发送准备协议
    ClientSendMsg.SendReadyRoom()

    --self.gameObject:Destroy1()
end

function GameResult:Share_OnClick()
    PlatformHandler.CallShare("", "", "", "screenshot.png", "", "0")
end

function GameResult:TableClose()
    self.gameObject:Destroy1()
end
